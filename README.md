# NTU canoebot
If you are able to access this repo, you are able to download and host your own canoebot!

---
## Prerequisites

### For Debian/Ubuntu-based systems:
Install the venv package for python3 by running:

`sudo apt install python3-venv`

Install the dependency for lxml by running:

`sudo apt install libxslt-dev`

### For Raspberry Pi (3B and up, zero 2)
Install the numpy c-extensions by running:

`sudo apt install libatlas-base-dev`

---

## Installing
This bot is designed to work on Linux-based systems E.g. Debian, Arch, WSL.
1. Fork this repository

    If you plan to run the bot based off this repo, you will need to request for
    access and [create a personal access token.](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#creating-a-token)

2. clone the repository using the command below:

    where username: your username (if you've cloned it)

    where access_token: your generated access token.

    This step is important, as it allows the bot to perform a shallow pull
    without any need to authenticate again.

`git clone "https://{username}:{access_token}@github.com/{username}/NTU_canoebot.git"`

3. Navigate to the repository using:

`cd /path/to/this/repo`

4. Install python dependencies by running the install script:

`bash ./.scripts/install.sh`

This script installs the necessary python modules in a virtual environment, adds bash aliases to start/stop/view logs, and sets up crontabs.

---

## Uninstalling
Navigate to the source directory and run:

`bash ./.scripts/uninstall.sh`

---

## Configuring
Now that the bot has been installed, it needs to be set up to point to all the necessary Google resource IDs in order to function properly.
Navigate to the following directory:

`cd ./.configs && ls -al`

Note the files that contain "template" in them.
These will be the only files that require modification.
Let's go over what needs to be modified for each file.

### botsettings.template.json
This file contains common settings shared between the debug and deployed versions of the bot.
For the most part, this file does not need to be modified.

### botsettings.template.deploy.json
This file contains private parameters (API keys, google sheet IDs)
The example file for reference is `botsettings.template.d.json`.
Create a copy of this file and rename it to `botsettings.template.deploy.json`.
Add the API key for the deployed version of the bot, google forms resource IDs, and set the logging level to "INFO" to show informational logs and above.

### botsettings.template.debug.json
This file also takes reference to `botsettings.template.d.json`.
Follow the same procedure as above, but name the file `botsettings.template.debug.json` instead.
Change the API key to a different bot, and change the log level to "DEBUG".

### Review
Altogether there should now be 3 'template' JSON files inside `./.configs`:
- `botsettings.template.json`
- `botsettings.template.deploy.json`
- `botsettings.template.debug.json`

During startup, these files will be read and merged, creatiing 2 more files:
- `botsettings.json`: Actual deployed configuration file read in by canoebot
- `botsettings.debug.json`: Debug configuration file

Do not modifiy those files, they will change with every startup if any of the template files are modified.

---

## Usage
After running the install script there should be 6 new bash aliases added to your `~/.bash_aliases` file:

1. `canoebotrestart`
2. `canoebotstop`
3. `canoebotlog`
4. `canoebotupdate`
5. `canoebotdeploy`
6. `canoebotdebug`

Aliases 1-3 are pretty self-explainatory.
Alias **#1** is used to start/restart the bot.
Any modifications to code or configs should be reflected on the new startup.
**#3** shows a rolling output of the logs generated by the bot.
This is useful when debugging or tracing back exceptions during runtime.
A log file in `./.scripts/canoebot.log` contains logs from the most recent startup of the bot.

Aliases 4-6 are used when updating the bot.
Note that **#4** pulls directly from this repo (or yours, if you've forked it).
So any buggy code that has not been fixed will be pulled as well.
After running **#4** the bot defaults to debug mode.
To change this, run **#5** to switch to deploy mode.

Updating and configuring can be done while the bot is still running.
To apply any new changes, run **#1**.

